<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Spacemesh Platform Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Spacemesh Platform Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Spacemesh Platform Docs" href="/opensearch.xml"><title data-react-helmet="true">Sync | Spacemesh Platform Docs</title><meta data-react-helmet="true" property="og:url" content="https://platform.spacemesh.io/docs/next/protocol/sync/overview"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Sync | Spacemesh Platform Docs"><meta data-react-helmet="true" name="description" content="In order for a node to fully participate in the Spacemesh protocol, including the Consensus protocol, it is essential that the node be aware of the current state of the network. This includes knowing the current layer and epoch, the latest blocks and transactions, and the current set of eligible miners. (Other aspects of the protocol, such as the canonical ledger and the global state, are things the node can work out for itself based on these data.)"><meta data-react-helmet="true" property="og:description" content="In order for a node to fully participate in the Spacemesh protocol, including the Consensus protocol, it is essential that the node be aware of the current state of the network. This includes knowing the current layer and epoch, the latest blocks and transactions, and the current set of eligible miners. (Other aspects of the protocol, such as the canonical ledger and the global state, are things the node can work out for itself based on these data.)"><link data-react-helmet="true" rel="shortcut icon" href="/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://platform.spacemesh.io/docs/next/protocol/sync/overview"><link data-react-helmet="true" rel="alternate" href="https://platform.spacemesh.io/docs/next/protocol/sync/overview" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://platform.spacemesh.io/docs/next/protocol/sync/overview" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.649d01d5.css">
<link rel="preload" href="/assets/js/runtime~main.00b9df03.js" as="script">
<link rel="preload" href="/assets/js/main.38b8c516.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs"><img src="/favicon.png" alt="Spacemesh" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/favicon.png" alt="Spacemesh" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Spacemesh Platform</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/protocol/sync/overview">Next</a></li><li><a class="dropdown__link" href="/docs/protocol/sync/overview">0.1.0</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs"><img src="/favicon.png" alt="Spacemesh" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/favicon.png" alt="Spacemesh" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Spacemesh Platform</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/next/protocol/sync/overview">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/protocol/sync/overview">0.1.0</a></li><li class="menu__list-item"><a class="menu__link" href="/versions">All versions</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Platform</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/">Welcome</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Protocol</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/protocol/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/protocol/p2p/overview">Peer to Peer</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Consensus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/consensus/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/consensus/deepdive">Deep Dive</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Hare</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/hare/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/hare/faq">FAQ</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Mining</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/mining/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/mining/post">PoST</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/mining/poet">PoET</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/protocol/mining/activations">Activations</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/next/protocol/sync/overview">Sync</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/protocol/transactions/overview">Transactions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/next/api/overview">Overview</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for Spacemesh Platform Docs <strong>Next</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/protocol/sync/overview">latest version</a></strong> (0.1.0).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_3a4h">Sync</h1></header><div class="markdown"><p>In order for a node to fully participate in the Spacemesh protocol, including the <a href="/docs/next/protocol/consensus/overview">Consensus protocol</a>, it is essential that the node be aware of the current state of the network. This includes knowing the current <a href="/docs/next/protocol/overview#spacemesh-basics">layer and epoch</a>, the latest blocks and <a href="/docs/next/protocol/transactions/overview">transactions</a>, and the current <a href="/docs/next/protocol/mining/activations">set of eligible miners</a>. (Other aspects of the protocol, such as the canonical ledger and the global state, are things the node can work out for itself based on these data.)</p><p>In addition to receiving <em>new</em> data as it becomes available, this also means that the node must be able to fetch historical data, such as when a new node first comes online, or after a node reconnects to the network after having been offline for some time.</p><p>The Sync subprotocol is the means by which a node achieves this: it sends and receives messages over the Spacemesh <a href="/docs/next/protocol/p2p/overview">P2P network</a>, and listens for new blocks and transactions.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="getting-data"></a>Getting data<a class="hash-link" href="#getting-data" title="Direct link to heading">#</a></h2><p>There are fundamentally only two ways that a node synchronizes data in Spacemesh: gossip and direct request.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gossip"></a>Gossip<a class="hash-link" href="#gossip" title="Direct link to heading">#</a></h3><p>The <a href="/docs/next/protocol/p2p/overview#gossip">gossip protocol</a> is the primary way that data are propagated throughout the network. Every time a block receives a new, syntactically valid transaction, it immediately shares it with all of its peers. Every time a miner produces a new candidate block, or receives one from a peer, it immediately shares it with all of its peers. In this way, these data propagate quickly throughout the entire network.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="direct-request"></a>Direct request<a class="hash-link" href="#direct-request" title="Direct link to heading">#</a></h3><p>Many data structures in Spacemesh, such as blocks and ATXs, rely on (or &quot;point to&quot;) other pieces of data. For instance, a block contains a <code>view</code> that contains the IDs of blocks in previous layers, and it contains the ID of an <a href="/docs/next/protocol/mining/activations">ATX</a> that establishes the eligibility of the miner to produce that block in that layer. Similarly, an ATX references a <a href="/docs/next/protocol/mining/poet">PoET proof</a>. When a node receives a block or an ATX, it needs to have access to these dependent data structures to perform validation on it.</p><p>When the node receives a new block or ATX, the first thing it does is to attempt to find all of the other pieces of data that the data structure points to. The node first checks its local database, but if it doesn&#x27;t already have the data (i.e., has never seen this particular piece of data before), then it sends a direct request to its peers for the missing data. If a peer has the data in question, it responds with the data. If none of its peers have the data either, then the data structure in question is deemed invalid.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resolving-dependencies"></a>Resolving dependencies<a class="hash-link" href="#resolving-dependencies" title="Direct link to heading">#</a></h3><p>Note that these dependencies are recursive: for instance, a block may point to another block that points to an ATX that points to a PoET proof, none of which the node has seen before. The node keeps a separate request queue for each distinct data type, and the dependency tree is explored in breadth-first fashion, and in such a way that the same dependency is never fetched twice. To continue with the example, once the PoET proof is retrieved, it resolves all of the dependencies for the ATX, which is thus validated. This in turn resolves all of the dependencies for the block, which in turn is deemed valid, and so on. The dependencies are unwound in recursive fashion.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initial-sync"></a>Initial sync<a class="hash-link" href="#initial-sync" title="Direct link to heading">#</a></h2><p>When a node first joins the network, of course it knows nothing about the current state of the network. It completes a <a href="/docs/next/protocol/p2p/overview#bootstrap-and-peer-discovery">bootstrap and peer discovery</a> process to find peers to pair and exchange data with. It next checks whether it&#x27;s in sync with the network: i.e., whether the latest layer that it knows about (the genesis layer, the only layer a new node knows about) is the latest known layer in existence. It will discover newer layers from its peers, thus beginning the sync process. There is no explicit &quot;initial sync&quot;; rather, the sync happens implicitly, via the direct request method described above, as the node receives new dataâ€”new blocks and layersâ€”from its peers, and subsequently requests the data that they rely on.</p><p>Once this initial sync process completes, the node switches into a mode known as &quot;weakly synced&quot; and begins to listen to gossip messages to be notified about new data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-availability"></a>Data availability<a class="hash-link" href="#data-availability" title="Direct link to heading">#</a></h2><p>As described above, data structures contain pointers to other data structures. This is to save space in the mesh: it doesn&#x27;t make sense for every block to contain a copy of all of the other blocks it points to, or to contain the ATX it points to, since many blocks may point to the same one! However, this presents a challenge of data availability: given a piece of data, such as a block, how do we ensure that all of the data that it relies on are available?</p><p>In short, any data structure is considered invalid in Spacemesh if any of the data it relies on are unavailable (i.e., if none of a node&#x27;s peers have the missing data). Miners should never mine, or gossip, a block with pointers to invalid or missing data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="layers-the-clock-and-sync"></a>Layers, the clock, and sync<a class="hash-link" href="#layers-the-clock-and-sync" title="Direct link to heading">#</a></h2><p>The syncer polls against the clock and the database to figure out the most recent layer a node should know about, and the most recent layer it actually knows about. Based on this information, it can re-enter syncing mode if the node falls out of sync. If a node is, e.g., temporarily offline, once it comes back online and realizes it&#x27;s fallen behind, it switches back into sync mode to fetch the missing data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="weakly-vs-fully-synced"></a>Weakly vs. fully synced<a class="hash-link" href="#weakly-vs-fully-synced" title="Direct link to heading">#</a></h2><p>There are two notions of sync in Spacemesh: weakly and fully synced.</p><p><strong>Weakly synced</strong> means that a node knows about the most recent layer in the mesh (which it can calculate using the clock). However, a node that is weakly synced has no way of knowing whether it&#x27;s seen all of the blocks for this layer.</p><p><strong>Fully synced</strong> means that a node has finished processing all of the blocks for the most recent layer in the mesh.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="synchronization-status-and-participation-in-consensus"></a>Synchronization status and participation in consensus<a class="hash-link" href="#synchronization-status-and-participation-in-consensus" title="Direct link to heading">#</a></h2><p>While a node begins to receive gossip messages as soon as it&#x27;s connected to peers, some subprotocols such as <code>sync</code> and <code>hare</code> discard these messages until the node is weakly synced. This is in order to prevent a DoS attack. Block generation and ATX generation are paused until a node is fully synced, and a node can only participate in the Hare consensus mechanism once it is fully synced.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sync-and-the-tortoise"></a>Sync and the Tortoise<a class="hash-link" href="#sync-and-the-tortoise" title="Direct link to heading">#</a></h2><p>Sync is what triggers the <a href="/docs/next/protocol/consensus/overview#tortoise">Tortoise protocol</a> to validate blocks. This works in two ways.</p><p>For the current layer, Sync waits a specified period of time, called <code>ValidationDelta</code>, to accumulate blocks. Once this interval has passed, it kicks off the Tortoise to process the votes in these new blocks. In the case where a node is synchronizing historical layers, each layer is processed as soon as all of its blocks are received.</p><p>For blocks that arrive late, i.e., for previous layers, Sync immediately passes the data to the Tortoise.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/spacemeshos/platform-docs/blob/main/docs/protocol/sync/01-overview.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-03-09T16:48:27.000Z" class="lastUpdatedDate_1WI_">3/9/2021</time> by <strong>Aviv Eyal</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/next/protocol/mining/activations"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Mining - Activations</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/next/protocol/transactions/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transactions Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-data" class="table-of-contents__link">Getting data</a><ul><li><a href="#gossip" class="table-of-contents__link">Gossip</a></li><li><a href="#direct-request" class="table-of-contents__link">Direct request</a></li><li><a href="#resolving-dependencies" class="table-of-contents__link">Resolving dependencies</a></li></ul></li><li><a href="#initial-sync" class="table-of-contents__link">Initial sync</a></li><li><a href="#data-availability" class="table-of-contents__link">Data availability</a></li><li><a href="#layers-the-clock-and-sync" class="table-of-contents__link">Layers, the clock, and sync</a></li><li><a href="#weakly-vs-fully-synced" class="table-of-contents__link">Weakly vs. fully synced</a></li><li><a href="#synchronization-status-and-participation-in-consensus" class="table-of-contents__link">Synchronization status and participation in consensus</a></li><li><a href="#sync-and-the-tortoise" class="table-of-contents__link">Sync and the Tortoise</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Explore</h4><ul class="footer__items"><li class="footer__item"><a href="https://spacemesh.io/testnet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Testnet</a></li><li class="footer__item"><a href="https://spacemesh.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="http://chat.spacemesh.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/teamspacemesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/spacemeshos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Spacemesh. This work is licensed under CC BY 4.0.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.00b9df03.js"></script>
<script src="/assets/js/main.38b8c516.js"></script>
</body>
</html>